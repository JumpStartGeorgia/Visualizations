var data=holidays;var chart_meta=null;var chart_data=null;var max_days=0;holidays.forEach(function(b,a){if(max_days<b.total){max_days=b.total}});var lang=d3.select("html").attr("lang");if(!(lang=="ka"||lang=="en")){lang="en";d3.select("html").attr("lang",lang)}var margin={top:60,right:20,bottom:30,left:150},width=1020-margin.left-margin.right,height=960-margin.top-margin.bottom,width_svg=1250;var x=d3.scale.linear().rangeRound([0,width]);var y=d3.scale.ordinal().rangeRoundBands([height,0],0);var color=null;var klass=null;var color_default=d3.scale.ordinal().range(["#5eddcc","#0ab5dd","#3286a0","#ff926f","#ccdee4"]).domain([0,1,2,3,4]);var tip=d3.tip().direction("n").attr("class","d3-tip").offset([-10,0]).html(function(a){return a});var svg=d3.select("content").append("svg").attr("width",width_svg).attr("height",height+margin.top+margin.bottom).append("g").attr("class","chart").attr("transform","translate("+(margin.left)+","+40+")");comment=comment[lang];d3.select(".filter select").on("change",function(a){sort(+this.options[this.selectedIndex].value)});function init(){x.domain([0,max_days]);y.domain(data.map(function(a){return a.country[lang]}));chart_data=svg.append("g").attr("class","data");chart_meta=svg.append("g").attr("class","meta");chart_meta.append("g").attr("class","x grid").attr("transform","translate(0,"+height+")").call(axis_x().tickSize(-height,0,0).tickFormat(""));chart_meta.append("g").attr("class","y grid").attr("transform","translate(0,"+y.rangeBand()/2+")").call(axis_y().tickSize(-width,0,0).tickFormat(""));init_legend();sort()}function sort(a){if(!exist(a)){a=0}switch(a){case 1:data.sort(function(d,c){return d.total-c.total});break;case 2:data.sort(function(d,c){if(d.national===c.national){return d.total-c.total}return d.national-c.national});break;case 3:data.sort(function(d,c){if(d.y1===c.y1){return d.total-c.total}return d.y1-c.y1});break;case 4:data.sort(function(d,c){if(d.y5===c.y5){return d.total-c.total}return d.y5-c.y5});break;case 5:data.sort(function(d,c){if(d.y10===c.y10){return d.total-c.total}return d.y10-c.y10});break;default:data.sort(function(d,c){return c.country[lang].localeCompare(d.country[lang])});break}refresh_items(a);redraw()}function redraw(){svg.selectAll(".g.item").remove();chart_meta.select(".x.axis").remove();chart_meta.select(".y.axis").remove();y.domain(data.map(function(b){return b.country[lang]}));chart_meta.append("g").attr("class","x axis").attr("transform","translate(-12,"+height+")").call(axis_x());chart_meta.append("g").attr("class","x axis").attr("transform","translate(-12,-23)").call(axis_x());chart_meta.append("g").attr("class","y axis").attr("transform","translate(-10,0)").call(axis_y());var a=chart_data.selectAll(".state").data(data).enter().append("g").attr("class","g item").attr("transform",function(b){return"translate(0,"+y(b.country[lang])+")"}).on("mouseover",function(c,b){d3.select(this).classed("selected",true);tip.show(comment.replace("&country",c.country[lang]).replace("&y1",c.y1).replace("&y5",c.y1+c.y5).replace("&y10",c.y1+c.y5+c.y10).replace("&h",c.national).replace("&t",c.total))}).on("mouseout",function(c,b){d3.select(this).classed("selected",false);tip.hide()});a.selectAll("rect").data(function(b){return b.items}).enter().append("rect").attr("height",y.rangeBand()).attr("x",function(b){console.log(b);return x(b.y0)}).attr("width",function(b){return x(b.y1)-x(b.y0)}).attr("class",function(c,b){return klass(b)});svg.call(tip)}function axis_x(){return d3.svg.axis().scale(x).orient("bottom").tickValues(d3.range(1,max_days+1,1)).ticks(max_days).tickFormat(d3.format("d"))}function axis_y(){return d3.svg.axis().scale(y).orient("left")}function init_legend(){var a=legends.map(function(e){return e.name[lang]});var c=chart_meta.append("g").attr("class","legend").attr("transform",function(f,e){return"translate("+(width+15)+", 0 )"});var d=c.append("text").attr({x:0,y:18});d.append("tspan").text(labels.legend_title[lang].split("&n")[0]);d.append("tspan").attr({x:0,dy:18}).text(labels.legend_title[lang].split("&n")[1]);var b=c.selectAll(".item").data(a).enter().append("g").attr("class","item").attr("transform",function(f,e){return"translate("+0+","+(e*25+36)+")"});b.append("rect").attr({y:16,width:16,height:16,rx:1,ry:1}).style("fill",color_default);b.append("text").attr("y",23).attr("x",25).attr("dy",".35em").text(function(e){return e});c.append("line").attr({x1:"0",y1:"160",x2:"200",y2:"160",fill:"none",stroke:"#8F9B9B","stroke-width":1,"stroke-miterlimit":10}).style({opacity:0.6});c.append("rect").attr({y:170,width:8,height:8,fill:"#3286a0",rx:1,ry:1});var d=c.append("text").attr({x:15,y:179});d.append("tspan").text(labels.legend_comment1[lang].split("&n")[0]);d.append("tspan").attr({x:15,dy:18}).text(labels.legend_comment1[lang].split("&n")[1]);d.append("tspan").attr({x:15,dy:18}).text(labels.legend_comment1[lang].split("&n")[2]);d.append("tspan").attr({x:15,dy:18}).text(labels.legend_comment1[lang].split("&n")[3]);c.append("rect").attr({y:260,width:8,height:8,fill:"#ff926f",rx:1,ry:1});var d=c.append("text").attr({x:15,y:269});d.append("tspan").attr({x:15}).text(labels.legend_comment2[lang].split("&n")[0]);d.append("tspan").attr({x:15,dy:18}).text(labels.legend_comment2[lang].split("&n")[1])}function refresh_items(a){data.forEach(function(j){j.items=[];var b=["#5eddcc","#0ab5dd","#3286a0","#ff926f","#ccdee4"];var g=["item-year1","item-year5","item-year10","item-national","item-empty"];var c=[0,1,2,3,4];var l=[j.y1,j.y5,j.y10,j.national,max_days-j.total];var h=[];var f=[];if(a==2){c=[3,0,1,2,4]}else{if(a==4){c=[1,2,0,3,4]}else{if(a==5){c=[2,1,0,3,4]}}}var k=0;for(var e=0;e<5;++e){j.items.push({y0:k,y1:k+=l[c[e]]});f.push(g[c[e]]);h.push(b[c[e]])}color=d3.scale.ordinal().range(h).domain([0,1,2,3,4]);klass=d3.scale.ordinal().range(f).domain([0,1,2,3,4])})}function exist(a){return typeof a!=="undefined"&&a!==null&&a!==""}init();