<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Timeline of Georgia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 78px; /* 78px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="css/timeline_source.css" rel="stylesheet">
    <link href="css/timeline.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
<!--
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
		<link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
		<link rel="shortcut icon" href="../assets/ico/favicon.png">
-->
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="#"><img src="img/timeline-of-georgia_logo.png" alt="Timeline of Georgia"/></a>
          <ul class="nav pull-right">
            <li id="language"><a id="language_switcher" href="#">English</a></li>
            <li id="js_logo"><a href="http://jumpstart.ge" target="_blank"><img src="img/jumpstart_logo.png" alt="JumpStart Georgia"/></a></li>
          </ul>
        </div>
      </div>
    </div>

		<div id="container-content" class="container-fluid">
		  <div id="hidden_form" class="container-fluid" >
		    <form id="event_form" action="">
		      <ul class="list_float">
		        <li id="hidden_form_header" class="align_top">
    		      <h3>Add an Event</h3>
    		      <p>Did we miss something?  Let us know and we will add it to the timeline.</p>
		        </li>
		        <li class="align_top">
    		      <ul class="list_float list_float_textarea">
    		        <li class="align_top">
    		          Event Description <abbr title="Required">*</abbr>
    		        </li>
    		        <li>
    		          <textarea rows="5" cols="50" name="event"></textarea>
    		        </li>
    		      </ul>
		        </li>
		        <li>
              <ul>
    		        <li>
        		      <ul class="list_float list_float_fields">
        		        <li>
        		          Event Date
        		        </li>
        		        <li>
        		          <input type="date" name="date">
        		        </li>
        		      </ul>
    		        </li>
    		        <li>
        		      <ul class="list_float list_float_fields">
        		        <li>
        		          Media Link
        		        </li>
        		        <li>
        		          <input type="text" name="link">
        		        </li>
        		      </ul>
    		        </li>
    		        <li>
        		      <ul class="list_float list_float_fields">
        		        <li>
        		          Your Name
        		        </li>
        		        <li>
        		          <input type="text" name="name">
        		        </li>
        		      </ul>
    		        </li>
    		        <li>
        		      <ul class="list_float list_float_fields">
        		        <li>
        		          Your E-mail
        		        </li>
        		        <li>
        		          <input type="email" name="email">
        		        </li>
        		      </ul>
    		        </li>
              </ul>
		        </li>
		        <li>
		          <img id="btn_submit" src="img/add.png" alt="Add" />
		        </li>
		        <li class="align_top">
		          <div id="loading">
		            <img src="css/loading.gif" />
		          </div>
		          <div id="success_submit">
		            Thank you for your submission!
		          </div>
		          <div id="error_submit">
		            Sorry, an error occurred.
		          </div>
		          <div id="required_submit">
		            Event Description is required.
		          </div>
		        </li>
          </ul>
	      </form>
		  </div>
			<div id="timeline-embed">
        <div id="slide_up_container">
  			  <img id="img_slide_up" src="img/slide_up.png" />
        </div>
			</div>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
		<script type="text/javascript" src="js/jquery-min.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/storyjs-embed.js"></script>
		<script type="text/javascript" src="js/timeline-min.js"></script>
		<script>
        var lang = 'ka';

        function GetQueryStringParams(sParam)
        {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++)
            {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam)
                {
                    return sParameterName[1];
                }
            }
        }


        function init_timeline(){
          var source = 'https://docs.google.com/spreadsheet/pub?key=0AtUyMZoeaZt8dFpyUXpIQXczc2N1WUZWV01UUlN3VFE&output=html';

          if (lang !== undefined && lang == 'en'){
            source = 'https://docs.google.com/spreadsheet/pub?key=0AtUyMZoeaZt8dFRCYzRyaGJZb1gxWXk2QnF6ZFFmZnc&output=html';
          }
console.log("lang = '" + lang + "'");
				  createStoryJS({
					  type:		'timeline',
					  width:		'100%',
            lang:     lang,
					  height:		String($(window).height()-$('.navbar').height()),
					  source:		source,
					  embed_id:	'timeline-embed',
            hash_bookmark: true,
					  debug:		false
				  });
        }

      function set_language_switcher(){
        var link = $('a#language_switcher');
        if (lang !== undefined && lang == 'en'){
            $(link).text('ქართული');
            $(link).attr('href', '?lang=ka');
        } else {
            $(link).text('English');
            $(link).attr('href', '?lang=en');
        }

      }

			$(document).ready(function() {
        lang = GetQueryStringParams('lang');
        if (lang === undefined){
          lang = 'ka';
        }
        set_language_switcher();
        init_timeline();

        $('a#language_switcher').click(function() {
          window.location.href = $(this).attr('href') + location.hash;
          return false;
        });

        $('img#btn_submit').click(function() {
          $('form#event_form').submit();
        });

        $('form#event_form').submit(function() {
          $('#loading').fadeIn();

          // get the values
          var event, date, link, name, email;
          event = $('textarea[name="event"]').val();
          date = $('input[name="date"]').val();
          link = $('input[name="link"]').val();
          name = $('input[name="name"]').val();
          email = $('input[name="email"]').val();

          if (event === ''){
            // show required msg
            $('#loading').hide();
            $('#required_submit').fadeIn().delay(5000).fadeOut();
            $('textarea[name="event"]').focus();
          }else {
            // send email
            var dataString = "event="+event+"&date="+date+"&link="+link+"&name="+name+"&email="+email;
            $.ajax({
                type: "POST",
                url: "send_mail.php",
                data: dataString,
                dataType:"json",
                timeout: 5000,
                error: function(response) {
                  $('#loading').hide();
                  if(response.status === "success") {
                    // reset form fields
                    $('form#event_form input').val('');
                    $('form#event_form textarea').val('');

                    // show success message
                    $('#success_submit').fadeIn().delay(5000).fadeOut();
                  } else{
                    // show error message
                    $('#error_submit').fadeIn().delay(5000).fadeOut();
                  }
                },
                success: function(response) {
                  $('#loading').hide();
                  if(response.status === "success") {
                    // reset form fields
                    $('form#event_form input').val('');
                    $('form#event_form textarea').val('');

                    // show success message
                    $('#success_submit').fadeIn().delay(5000).fadeOut();
                  } else{
                    // show error message
                    $('#error_submit').fadeIn().delay(5000).fadeOut();
                  }
                }
               });
          }
          return false;
        });

        $('img#img_slide_up').click(function() {
          $('div#hidden_form').toggle('slow', function(){
            var deg = 180;
            if ($('div#hidden_form').is(':visible')){
              deg = 0;
            }
            var rotate = {
              'transform':'rotate(0' + deg + 'deg)',
              '-ms-transform':'rotate(0' + deg + 'deg)',
              '-moz-transform':'rotate(0' + deg + 'deg)',
              '-webkit-transform':'rotate(0' + deg + 'deg)',
              '-o-transform':'rotate(0' + deg + 'deg)'
            };
            $('img#img_slide_up').css(rotate);
          });
        });
			});
		</script>
    <script type="text/javascript">
      // apply analytics if this is the live site
      if (document.URL.indexOf("http://visuals.jumpstart.ge/timeline/") != -1){
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-12801815-13']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      }
    </script>
  </body>
</html>
